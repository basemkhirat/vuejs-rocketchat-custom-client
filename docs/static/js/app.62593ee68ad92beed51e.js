webpackJsonp([1],{CIqn:function(e,t){},GjiO:function(e,t){},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("7+uW"),s={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var r=n("VU/8")({name:"App"},s,!1,function(e){n("GjiO")},null,null).exports,a=n("/ocq"),i=n("FZ+h"),c=function(e){return new i.RealTimeAPI(e)},u=null,d={name:"Chat",data:function(){return{webSocketUrl:"wss://open.rocket.chat/websocket",connectedToApi:!0,loggedIn:!1,userId:"",authToken:"",username:"",password:"",roomName:"sandbox",roomId:"Drjw54ftqGa4antMW",roomConnected:!1,newMessage:"",messages:[],errors:[],lastSync:(new Date).getTime(),syncInterval:3e4}},mounted:function(){var e=this;(u=c(this.webSocketUrl)).onError(function(t){return e.errors.push(t)}),u.onCompletion(function(){return console.log("finished")}),u.onMessage(function(t){e.messages.push(t)}),u.connectToServer().subscribe(function(){u.keepAlive()},function(t){e.errors.push(t)}),setInterval(function(){var e=(new Date).getTime();console.log("verify sync"),e-this.lastSync>this.syncInterval&&(console.log("out of sync"),this.syncPage())},2e3)},methods:{decoWs:function(){var e=u.webSocket;for(var t in e)"function"==typeof e[t]&&console.log(t.toString());u.webSocket.complete()},recoWs:function(){var e=this;(u=c(this.webSocketUrl)).onError(function(t){return e.errors.push(t)}),u.onCompletion(function(){return console.log("finished")}),u.onMessage(function(t){e.messages.push(t)}),u.connectToServer().subscribe(function(){u.keepAlive()},function(t){e.errors.push(t)})},login:function(){var e=this;this.loggedIn||u.loginWithAuthToken(this.authToken).subscribe(function(t){"result"===t.msg&&(e.messages.push(t.msg),e.loggedIn=!0)},function(t){e.errors.push(t)})},loginBasic:function(){var e=this;this.loggedIn||u.login(this.username,this.password).subscribe(function(t){"result"===t.msg&&(e.messages.push(t.msg),e.loggedIn=!0)},function(t){e.errors.push(t)})},connectRoom:function(){this.roomConnected||u.sendMessage({msg:"sub",id:""+(new Date).getTime(),name:"stream-room-messages",params:[this.roomId,!1]})},sendMessage:function(){u.sendMessage({msg:"method",method:"sendMessage",id:""+(new Date).getTime(),params:[{_id:""+(new Date).getTime(),rid:this.roomId,msg:this.newMessage}]}),this.newMessage=""},formatMessage:function(e){var t={message:e};return void 0!==e.fields&&void 0!==e.fields.args&&e.fields.args.length>0&&void 0!==e.fields.args[0].ts&&void 0!==e.fields.args[0].ts.$date&&(t.formattedDate=new Date(e.fields.args[0].ts.$date)),t},syncPage:function(){this.lastSync=(new Date).getTime(),console.log("Synch"),this.connectedToApi&&u&&null!==u.webSocket&&null==u.webSocket.socket&&(console.log("reload"),window.location.reload())}}},l={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"chat"},[e._m(0),e._v(" "),n("div",[e._v("Rocket.Chat websocket URL : "+e._s(e.webSocketUrl)+"\n    ")]),e._v(" "),n("table",[n("tbody",[n("tr",[n("th",[e._v("Token auth")]),e._v(" "),n("td",[e._v("UserId : "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.userId,expression:"userId"}],attrs:{type:"text",disabled:e.loggedIn},domProps:{value:e.userId},on:{input:function(t){t.target.composing||(e.userId=t.target.value)}}})]),e._v(" "),n("td",[e._v("Auth Token : "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.authToken,expression:"authToken"}],attrs:{type:"text",disabled:e.loggedIn},domProps:{value:e.authToken},on:{input:function(t){t.target.composing||(e.authToken=t.target.value)}}})]),e._v(" "),n("td",[e.loggedIn?e._e():n("button",{on:{click:e.login}},[e._v("Login")])])]),e._v(" "),n("tr",[n("th",[e._v("Basic auth")]),e._v(" "),n("td",[e._v("Username : "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],attrs:{id:"login",type:"text",disabled:e.loggedIn},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}})]),e._v(" "),n("td",[e._v("Password : "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],attrs:{id:"password",type:"password",disabled:e.loggedIn},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}})]),e._v(" "),n("td",[e.loggedIn?e._e():n("button",{on:{click:e.loginBasic}},[e._v("Login")])])]),e._v(" "),n("tr",[n("th",[e._v("Connect to room")]),e._v(" "),n("td",[e._v("Room id (default sandbox) : "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.roomId,expression:"roomId"}],attrs:{type:"text"},domProps:{value:e.roomId},on:{input:function(t){t.target.composing||(e.roomId=t.target.value)}}})]),e._v(" "),n("td",[e.roomConnected?e._e():n("button",{on:{click:e.connectRoom}},[e._v("Subscribe to room")])])])])]),e._v(" "),n("div",[n("h2",[e._v("Messages")]),e._v(" "),n("div",[e._v("\n        Send message : "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.newMessage,expression:"newMessage"}],attrs:{type:"text"},domProps:{value:e.newMessage},on:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.sendMessage(t)},input:function(t){t.target.composing||(e.newMessage=t.target.value)}}}),e._v(" "),n("button",{on:{click:e.sendMessage}},[e._v("Send")])]),e._v(" "),n("div",{staticStyle:{"max-height":"400px","overflow-y":"scroll"},attrs:{id:"messages"}},e._l(e.messages,function(t,o){return n("div",{key:o,staticClass:"message"},[e.formatMessage(t).formattedDate?n("b",[e._v("\n            "+e._s(e.formatMessage(t).formattedDate))]):e._e(),e._v(" "),n("code",[e._v(e._s(t))])])}))]),e._v(" "),n("div",[n("button",{on:{click:e.decoWs}},[e._v("Deco Ws")]),e._v(" "),n("button",{on:{click:e.recoWs}},[e._v("Reco Ws")])])])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("p",[this._v("Use Rocket.Chat REST API to get your userId and token")]),this._v(" "),t("div",[t("pre",[t("code",[this._v('curl -X "POST" "https://chat.myserver.com/api/v1/login" \\\n-H "Content-Type: application/json; charset=utf-8" \\\n-d $\'{\n"username": "my_username",\n"password": "my_password"\n  }\'')])])])])}]};var m=n("VU/8")(d,l,!1,function(e){n("CIqn")},null,null).exports;o.a.use(a.a);var v=new a.a({routes:[{path:"/",name:"Chat",component:m}]});o.a.config.productionTip=!1,new o.a({el:"#app",router:v,components:{App:r},template:"<App/>"})}},["NHnr"]);
//# sourceMappingURL=app.62593ee68ad92beed51e.js.map